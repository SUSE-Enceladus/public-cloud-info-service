<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Open Source Solutions for Enterprise Servers, Cloud &amp; Storage | SUSE</title>

  <link rel="icon" type="image/png" href="https://www.suse.com/favicon.ico">
  <link rel="stylesheet" href="https://www.suse.com/min/?b=assets/css&amp;f=bootstrap.css,helpers.css,jquery-ui.min.css,featherlight.min.css,featherlight.gallery.min.css,lightslider.css,main.css,iefix.css">
  <link rel="stylesheet" href="https://www.suse.com/assets/css/font-awesome.css">
  <script type="text/javascript" src="https://www.suse.com/min/?b=assets/js&amp;f=jquery-2.1.3.min.js,dummyfile.js"></script>
  
  <script src="assets/js/jquery.min.js"></script>
  <script src="assets/js/jsviews.min.js"></script>
  <script src="assets/js/jsrender.min.js"></script>
  <script src="assets/js/jquery.dataTables.min.js"></script>
  <link rel="stylesheet" href="assets/css/jquery.dataTables.min.css"/>
  <script src="assets/js/pluralize.js"></script>
</head>

<body>
  <header class="nocontent">
    <div class="clear"></div>
    <div id="utilitynav">
      <div class="container-fluid" style="max-width: unset;">
        <div class="logo" style="height: 100px;">
          <a href="https://www.suse.com">
              <img class="logo" src="https://www.suse.com/assets/img/suse-white-logo-green.svg">
          </a>
        </div>
      </div>
    </div>
  </header>
  <div class="top-banner" style='padding-top: 110px !important;'></div>
  
  <!--  -->
  
  <div style="padding: 10px;">
    <div>
        <h1>PINT - The Public Cloud INformation Tracker</h1>
        <p>This service provides data about the images SUSE publishes in various
        public cloud frameworks (Amazon, Google, Microsoft and Oracle) as well
        as the servers that make up the SUSE maintained and operated
        update infrastructure in those frameworks.</p>
        
        <select id='csp' class='cloudProvider'></select>
      	<div id="result">
      	</div>
    </div>
  </div>
  
  <!--  -->
  
  <!--footer>
    <div class="container-fluid">
      <div class="row">
        <div class="footer">
          <div class="copy-left">
            Â©
            <script type="text/javascript">
            var d = new Date(); document.write(d.getFullYear() + " ");
            </script> SUSE, All Rights Reserved
          </div>
          <div class="clear"></div>
        </div>
      </div>
    </div>
  </footer-->

  <style>
  .cloudProvider {
  float: left;
  margin-right: .5%;
  }
  </style>

  <script id="theTmpl" type="text/x-jsrender">
  <select id="state">
  <option value="" default>All states</option>
  {{for states sort=true}}
  <option value="{{:}}">{{:}}</option>
  {{/for}}
</select>

{{if regions.length > 0}} <!-- some CSP may have not regions -->
  <select id= "region">
    <option value="" default>All {{:regionName}}</option>
  {{for regions sort=true}}
    <option value="{{:}}">{{:}}</option>
  {{/for}}
  </select>
{{/if}}

<table id="coolTable" class="display">
  <thead>
  {{for attributes}}
    <th>{{:}}</th>
  {{/for}}
  </thead>
  <tbody>
  {{for images ~attributes=attributes}}
  <tr class="odd">
  {{for ~attributes ~imgData=#data}}
        <td>{{:~imgData[#data]}}</td>
  {{/for}}
    </tr>
    {{/for}}
  </tbody>
</table>
</script>

  <script>
  var images = [];
  var attributes = {};
  var regions = {};
  var states = {};

  var regionIdx = {};
  var stateIdx = {};
  var cspFiles= '';

  jQuery.fn.dataTableExt.afnFiltering.push(
  function( oSettings, aData, iDataIdx ) {
  var state = $('#state').val();
  var region = $('#region').val();
  var current_csp = $('#csp').val();

  var result = true;

  if (region) result = result && aData[regionIdx] == region;
  if (state) result = result && aData[stateIdx] == state;

  return result;
  }
  );

  var csps = {aws: '/v1/amazon/images.xml', azure: '/v1/microsoft/images.xml', gcp: '/v1/google/images.xml'}
  var cspsNames = {aws: 'Amazon Web Services', azure: 'Microsoft Azure', gcp: 'Google Cloud Platform'}

  var regionName = [];
  function set_values_csp(csp) {
  images = [];
  attributes = {};
  regions = {};
  states = {};
  regionIdx = {};
  stateIdx = {};

  $.get(csps[csp], function(xmlData) {
  var region = '';
  $(xmlData).find('image').each(function(idx, imgItem){
  var image = {};
  $(imgItem.attributes).each(function(idx, imgItem){
        image[imgItem.name] = imgItem.value;
        attributes[imgItem.name] = true;
        if (imgItem.name == 'region' || imgItem.name == 'environment') {
    regions[imgItem.value] = true;
    region = imgItem.name;
  }

        if (imgItem.name == 'state') states[imgItem.value] = true;
  });
  images.push(image);
  });

  var attrKeys = Object.keys(attributes);

  regionIdx = attrKeys.indexOf(region);
  stateIdx = attrKeys.indexOf('state');

  var template = $.templates("#theTmpl");
  template.link(
  "#result", {
        'attributes': Object.keys(attributes),
        'regions': Object.keys(regions),
        'states': Object.keys(states),
        'images': images,
  'regionName': pluralize(region)
  });

  var dataTable = $('#coolTable').DataTable();
  $('#state, #region').change(function() {
  dataTable.draw();
  });
  });
  }
  $(document).ready(function() {
  var defaultCsp = 'azure';
  $.each(csps, function(csp, option) {
  var name = cspsNames[csp];

  var attrs = {value: csp};
    if (csp == defaultCsp) {
      attrs['selected'] = true;
    }

  var option = $('<option/>').attr(attrs).text(name);
  $('#csp').append(option);
  });


  $('#csp').change(function() {
  set_values_csp($(this).val());
  });

  set_values_csp(defaultCsp);
  });
  </script>
  
</body>
</html>
